---
title: "scapesClassification"
subtitle: "An R-package for the classification of seascapes, landscapes and other geographic spaces represented as raster surfaces based on user-defined conditions" 
author: "Gerald H. Taranto^[OKEANOS-Azores University, Azores Deep Sea Research Group (@AzoresDeepSea), 9901‐862 Horta, Portugal. Email: gh.taranto@gmail.com]"
date: "`r format(Sys.time(), '%a %d, %B, %Y')`"
output: html_document

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(out.width = "100%", echo = TRUE)
```

# What is _scapesClassification_ ?
[_scapesClassification_](https://github.com/ghTaranto/scapesClassification "GitHub repository") is an R-package for the classification of seascapes, landscapes and other geo-spaces based on user-defined conditions. It allows users to translate task-oriented views of spaces and of geographic objects into computer representations. 

# How does _scapesClassification_ work?
Geo-spaces are classified using sets of user-defined conditions. These sets of conditions, presented in the form of [conditional statements](https://en.wikipedia.org/wiki/Conditional_(computer_programming) "Wikipedia definition"), can be applied simultaneously or sequentially. The second alternative is generally preferred. In fact, the rationale that guided the design of _scapesClassification_ is better implemented considering multi-step classification processes:

1. Geographic objects and segments of space can be identified by a unique class (or set of classes); 

2. Generally, it is easier to identify attributes that are distinctive of a portion of a class rather then identify its full range of attributes at once;

3. Thus, distinctive attributes can be used to map an initial set of locations to a class. These locations are hereafter referred to as ___anchor locations___;

4. Then, it becomes possible to map a location to a class not only considering its intrinsic attributes, but also its spatial relationships with anchor locations;

5. In particular, _class contiguity_ and _class continuity_ can be considered;

6. ___Class contiguity.___ Qualitative and/or quantitative conditions define the membership of a location to a class only if they occur in positions considered adjacent to a specific class;

7. ___Class continuity.___ When two adjacent locations are assigned to the same class using contiguity conditions, these conditions can be re-applied at positions neighboring the newly classified locations;

8. Distinct classes can be identified repeating the above process and considering the relationships expected to exist among classified and unclassified locations. 

------

# Geomorphic Management Units (GMUs) 
The following is an example of how to use _scapesClassification_ to classify marine seafloor structures, hereafter referred to as geomorphic management units (GMUs). Our study area is located in the 'Triangle' of the Azores (NE Atlantic), around the islands of Faial, Pico and São Jorge. GMUs will be identified using a `RasterStack` of six layers that includes bathymetry, bathymetric derivatives ([Walbridge et al., 2018](https://www.mdpi.com/2076-3263/8/3/94/htm)) and the geomorphons of the area ([Jasiewicz and Stepinski, 2013](https://www.sciencedirect.com/science/article/pii/S0169555X12005028#!)):
  
* **Bathymetry:** depth values;
* **Local BPI:** benthic position index (BPI) computed with an outer radius of 10px (ca. 5 km);
* **Regional BPI:** benthic position index (BPI) computed with an outer radius of 40px (ca. 20 km);
* **Slope:** slope values;
* **SD bathymetry:** standard deviation of bathymetric values computed on a 9x9 window;
* **Geomorphons:** identify basic morphological terrain types.

## Load libraries and data
We will start by loading the required libraries and data into the workspace:
```{r loadLD, message=FALSE, warning=FALSE, collapse = TRUE}
# LOAD LIBRARIES
library(raster)
library(scapesClassification)

# LOAD DATA
grd <- list.files(system.file("extdata", package = "scapesClassification"), full.names = T)
grd <- grd[grepl("\\.grd", grd)]
grd <- grd[!grepl("hillshade", grd)]
rstack <- stack(grd)
```

```{r hillShade, message=FALSE, include=FALSE}
# hillShade
hs <- list.files(system.file("extdata", package = "scapesClassification"), full.names = T)
hs <- raster(hs[grepl("hillshade\\.grd", hs)])
```

```{r loadMapView, message=FALSE, include=FALSE}
library(mapview)
library(leaflet)
library(leafem)

# set gerenal options 
mapviewOptions(basemaps = c("Esri.OceanBasemap", "OpenStreetMap"), na.color = "grey88", homebutton = FALSE, 
               query.position = "bottomright", legend.opacity = 0.9)

# set palettes
palRYB <- c("#2892c7", "#fafa64", "#e81014")
palYGB <- c("#ffff80" ,"#3dba65", "#0d1178")
palBYR <- c("#4575b5", "#ffffbf", "#d62f27")
gm_col <- c("grey70", "#380000", "#c80000", "#ff5014", "#fad23c", "#ffff3c", "#b4e614", "#3cfa96", "#0000ff", "#000038")
```
<a id="rstack"></a>
We can plot the raster stack as an interactive map using the R packages `mapview` and `leaflet`: 
```{r plotRSTACK, message=FALSE, warning=FALSE, echo=FALSE}
# plotRSTACK
m <- mapview(rstack[[1]], layer.name = c("Bathymetry (m)"), col.regions = palRYB) +
  mapview(rstack[[3]], layer.name = c("Local BPI"), col.regions = palBYR, hide = TRUE) + 
  mapview(rstack[[4]], layer.name = c("Regional BPI"), col.regions = palBYR, hide = TRUE) +
  mapview(rstack[[6]], layer.name = c("Slope (deg)"), col.regions = palYGB, hide = TRUE) + 
  mapview(rstack[[5]], layer.name = c("SD Bathymetry (9x9)"), col.regions = palYGB, hide = TRUE) + 
  mapview(as.factor(rstack[[2]]), layer.name = c("Geomorphons"), method = "ngb", col.regions = gm_col, at=0:10)
  
m@map %>% 
  hideGroup(c("Local BPI", "Regional BPI", "Slope (deg)", "SD Bathymetry (9x9)", "Geomorphons")) %>% 
  setView(lng = -28.55, lat = 38.45, zoom = 8) %>%
  addLayersControl(baseGroups = c("Esri.OceanBasemap", "OpenStreetMap"),
                   overlayGroups = c("Bathymetry (m)", "Local BPI", "Regional BPI", "Slope (deg)", "SD Bathymetry (9x9)", "Geomorphons"),
                   position = "topleft",
                   options = layersControlOptions(collapsed = FALSE))
```
_FIGURE 1 - Raster layers used for the classification of Geomorphic Management Units (GMUs). The geomorphon classes correspond to (1) flat, (2) summit, (3) ridge, (4) shoulder, (5) spur, (6) slope, (7) hollow, (8) footslope, (9) valley and (10) depression._







```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
