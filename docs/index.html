<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Seascape or Landscape Classification Using Environmental Data • scapesClassification</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Seascape or Landscape Classification Using Environmental Data">
<meta property="og:description" content="Classification of seascapes or landscapes using environmental 
  and geographic data stored as Raster* objects. The classification is 
  implemented using a stepwise procedure. At each step a portion of the 
  scape is classified based on user defined conditions, local spatial 
  statistics and/or spatial contiguity between classes. The portion of 
  scape classified can be considered in the next classification step. 
  User defined conditions can be absolute, relative to the focal cell or 
  relative to the focal neighbourhood.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">scapesClassification</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<ul>
<li>
<a href="#scapesclassification">scapesClassification</a>
<ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#why-scapesclassification">Why <code>scapesClassification</code>?</a></li>
<li>
<a href="#implementation">Implementation</a>
<ul>
<li><a href="#1format-inputs">1.Format inputs</a></li>
<li><a href="#2set-anchor-cells">2.Set anchor cells</a></li>
<li><a href="#3classify-raster-cells">3.Classify raster cells</a></li>
</ul>
</li>
<li>
<a href="#geomorphic-management-units">Geomorphic Management Units</a>
<ul>
<li><a href="#island-shelf-units">Island Shelf Units</a></li>
<li><a href="#high-relief-units">High Relief Units</a></li>
<li><a href="#reclassify-cells">Reclassify Cells</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- README.md is generated from README.Rmd. Please edit that file --><div id="scapesclassification" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#scapesclassification" class="anchor"></a>scapesClassification</h1></div>
<!-- badges: start -->
<!-- badges: end -->
<p>Classification of seascapes or landscapes using environmental and geographic data stored as <code>Raster*</code> objects. The classification is implemented using a stepwise procedure. At each step a portion of the “scape” is classified based on user defined conditions, local spatial statistics and/or spatial contiguity between classes. The portion of “scape” classified can be considered in the next classification step. User defined conditions can be absolute, relative to the focal cell or relative to the focal neighbourhood.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install the released version of scapesClassification from <a href="https://CRAN.R-project.org">CRAN</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># NOT YET</span>
<span class="co"># install.packages("scapesClassification", dependencies = TRUE)</span></code></pre></div>
<p>And the development version from <a href="https://github.com/">GitHub</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("devtools")</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"ghTaranto/scapesClassification"</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="why-scapesclassification" class="section level2">
<h2 class="hasAnchor">
<a href="#why-scapesclassification" class="anchor"></a>Why <code>scapesClassification</code>?</h2>
<p><code>scapesClassification</code> can be used in any situation where we need to classify seascapes or landscapes based on a set of conditions that consider class contiguity and environmental or geographic data stored as <code>Raster*</code> objects.</p>
<p>For instance, let’s imagine we want to evaluate the potential spillover of an animal population from a reserve (i.e. the capacity of a population resident in a protected area to reach and colonize unprotected areas). If we know some of the abiotic and biotic characteristics of its habitat, we could estimate the potential spillover as the amount of area adjacent to the reserve that meets the species’ habitat requirements. The first step would be to identify raster cells adjacent to the reserve having suitable habitat. We will call this type of cells <code>spillOver_Cell</code>. However, we can also suppose that once an animal reaches these cells, he could move further away from the reserve to other contiguous suitable cells. For simplicity, imagine that a cell is suitable if <code>var_x &gt;= value_y</code>. We can then solve our problem identifying all cells meeting the following conditions:</p>
<blockquote>
<p><strong>IF</strong></p>
<p><code>C</code> <em>is neighbour of</em> <code>reserve_Cell</code></p>
<p><strong>OR</strong></p>
<p><code>C</code> <em>is neighbour of</em> <code>spillOver_Cells</code></p>
<p><strong>AND</strong></p>
<p><code>var_x &gt;= value_y</code></p>
<p><strong>THEN</strong></p>
<p><code>C</code> <em>is</em> <code>spillOver_Cells</code></p>
</blockquote>
<p>In this case the classification process is iterative and depends on previous classification steps. In fact, as long as new cells are classified as <code>spillOver_Cells</code>, we will need to evaluate whether new contiguous cells meet our conditions or not.</p>
<p>We could also define this classification problem in more complex terms. For instance by considering areas with sub-optimal conditions as transition zones and areas adjacent to these transition zones showing improved habitat conditions as connected suitable areas. At the same time we could decide not to consider as suitable any cell adjacent to highways or urban areas and so on.</p>
<p><code>scapesClassification</code> represent a powerful tool to solve complex classification problems using class contiguity (or discontinuity), user defined conditions and any number of environmental and geographic variables.</p>
</div>
<div id="implementation" class="section level2">
<h2 class="hasAnchor">
<a href="#implementation" class="anchor"></a>Implementation</h2>
<p><code>scapesClassification</code> uses environmental and geographic raster to solve classification problems. Besides being thought of as a matrix, raster data can be thought of as a vector indexed by cell numbers (<a href="https://rspatial.org/raster/pkg/8-cell_level_functions.html?highlight=cell%20number">RSpatial</a>). Functions in the <code>scapesClassification</code> package rely on cell numbers to evaluate local conditions and spatial adjacency.</p>
<div id="1format-inputs" class="section level3">
<h3 class="hasAnchor">
<a href="#1format-inputs" class="anchor"></a>1.Format inputs</h3>
<p>In the first step the <code>Raster*</code> object is converted into an attribute table (<code>data.frame</code>). The first column of the attribute table, named <code>Cell</code>, refers to positions on the <code>Raster*</code> object. The attribute table includes <strong>only complete cases</strong>, i.e., raster cells having a value for every layer in the stack.</p>
<p>In the second step, we identify the <code>list</code> of 8-neighbors (<a href="https://en.wikipedia.org/wiki/Moore_neighborhood">Moore neighborhood</a>) of every cell in the attribute table. This list allows for a fast evaluation of local and class contiguity conditions.</p>
<p><strong>Functions:</strong> <code><a href="reference/attTbl.html">?attTbl</a></code> and <code><a href="reference/ngbList.html">?ngbList</a></code>.</p>
</div>
<div id="2set-anchor-cells" class="section level3">
<h3 class="hasAnchor">
<a href="#2set-anchor-cells" class="anchor"></a>2.Set anchor cells</h3>
<p>Anchor cells can be thought of as raster cells having particular characteristics from where the classification process can start. Anchor cells can be derived by: previous classifications (e.g., reserve cells), environmental or geographic characteristics (e.g., flat areas), local maxima or minima (e.g., local peaks on a mountain ridge) or spatial vector objects (e.g., shapefiles).</p>
<p><strong>Functions:</strong> <code><a href="reference/anchor.cell.html">?anchor.cell</a></code>, <code><a href="reference/anchor.seed.html">?anchor.seed</a></code>, <code><a href="reference/anchor.svo.html">?anchor.svo</a></code> and <code><a href="reference/cond.4.all.html">?cond.4.all</a></code>.</p>
</div>
<div id="3classify-raster-cells" class="section level3">
<h3 class="hasAnchor">
<a href="#3classify-raster-cells" class="anchor"></a>3.Classify raster cells</h3>
<p>Once anchor cells are defined, we can proceed with our classification considering <em>class contiguity</em> and a combination of <em>absolute</em>, <em>focal cell</em>, <em>focal neighborhood</em> and <em>directional neighborhood</em> conditions.</p>
<p>Conditions are passed to scapesClassification functions as a single <strong><code>character string</code></strong>. They can consist of combination of arithmetic (<code>+|-|*|/|^|%%|%/%</code>), relational (<code>&gt;|&lt;|&gt;=|&lt;=|==|!=|%/%</code>) and logic operators (<code>&amp;||</code>), base R functions (e.g., <code>abs(variable_name)</code>), variables names (i.e., <code>names(attTbl)</code>) and previous classifications (referred to and stored as <code>"classVector"</code>). (see <code>?contitions</code>).</p>
<p>Let us define:</p>
<ul>
<li><p><strong>focal cell:</strong> the cell whose neighbors are in evaluation;</p></li>
<li><p><strong>nbs cell</strong>: one of the neighbors in evaluation;</p></li>
<li><p><strong>focal neighborhood:</strong> when <em>absolute focal neighborhood conditions</em> are used, it includes <code>nbs</code> and its 8 neighbors; when <em>relative focal neighborhood conditions</em> are used, it only includes the 8 neighbors of <code>nbs</code>.</p></li>
<li><p><strong>directional neighborhood:</strong> it consists of the intersection set of the <code>focal cell</code> neighbors with the <code>focal neighborhood</code>. When <em>absolute focal neighborhood conditions</em> are used, it includes <code>nbs</code>, but it does not include the <code>focal cell</code>; when <em>relative focal neighborhood conditions</em> are used, it includes the <code>focal cell</code>, but it does not include <code>nbs</code>.</p></li>
</ul>
<!-- end list --><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">scapesClassification</span><span class="op">)</span>

<span class="co">## Matrix m mocking a raster of 3 rows and 4 columns</span>
<span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">4</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">m</span>
<span class="co">#&gt;      [,1] [,2] [,3] [,4]</span>
<span class="co">#&gt; [1,]    1    2    3    4</span>
<span class="co">#&gt; [2,]    5    6    7    8</span>
<span class="co">#&gt; [3,]    9   10   11   12</span>

<span class="co">## FOCAL CELL</span>
<span class="va">fc</span> <span class="op">&lt;-</span> <span class="fl">6</span>
<span class="va">fc</span>
<span class="co">#&gt; [1] 6</span>

<span class="co">## NBS CELLS</span>
<span class="va">nbs</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/nbg8.html">nbg8</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span>
<span class="va">nbs</span>
<span class="co">#&gt; [1]  1  2  3  5  7  9 10 11</span>

<span class="co"># CELL IN EVALUATION</span>
<span class="va">nbs1</span>      <span class="op">&lt;-</span> <span class="va">nbs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
<span class="va">nbs1</span>
<span class="co">#&gt; [1] 1</span>

<span class="co"># FOCAL NEIGHBORHOOD</span>
<span class="co"># Absolute:</span>
<span class="va">ab_fn_nbs1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">nbs1</span>, <span class="fu"><a href="reference/nbg8.html">nbg8</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="va">ab_fn_nbs1</span>
<span class="co">#&gt; [1] 1 2 5 6</span>

<span class="co"># Relative:</span>
<span class="va">r_fn_nbs1</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="reference/nbg8.html">nbg8</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="va">r_fn_nbs1</span>
<span class="co">#&gt; [1] 2 5 6</span>

<span class="co"># DIRECTIONAL FOCAL NEIGHBORHOOD</span>
<span class="co"># Absolute:</span>
<span class="va">ab_dfn_nbs1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">nbs1</span>, <span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="reference/nbg8.html">nbg8</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> , <span class="fu"><a href="reference/nbg8.html">nbg8</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">ab_dfn_nbs1</span>
<span class="co">#&gt; [1] 1 2 5</span>

<span class="co"># Relative:</span>
<span class="va">r_dfn_nbs1</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">fc</span>, <span class="fu"><a href="https://rdrr.io/r/base/sets.html">intersect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="reference/nbg8.html">nbg8</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> , <span class="fu"><a href="reference/nbg8.html">nbg8</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">r_dfn_nbs1</span>
<span class="co">#&gt; [1] 6 2 5</span></code></pre></div>
<p>The types of conditions that can be use include (see <code>"?conditions"</code>):</p>
<ul>
<li><p><strong>Class contiguity.</strong> Defines the sets of cells for which we want to evaluate our conditions. When it is not considered all cells that have not yet been classified are evaluated. When it is considered only cells that have not yet been classified AND that are adjacent (or not adjacent) to a specific group of classes are evaluated. In the latter case, both absolute and relative conditions can be used. Their evaluation is iterative. At each iteration, conditions are evaluated for the 8-neighbors (<code>nbs</code>) adjacent to the <code>focal cell</code>. <code>Focal cells</code> always belong to one of the classes of interest.</p></li>
<li><p><strong>Absolute conditions.</strong> Absolute conditions compare between <code>nbs</code> and user defined numeric values.</p></li>
<li><p><strong>Focal cell conditions.</strong> Focal cell conditions compare between the values of <code>nbs</code> and the value of the <code>focal</code> cell.</p></li>
<li><p><strong>Absolute focal neighborhood conditions.</strong> They compare each cell of <code>focal neighborhood</code> with a numeric value. The function <code>cond.4.nofn</code> can consider a <code>directional neighborhood</code> instead of a <code>focal neighborhood</code>.</p></li>
<li><p><strong>Relative focal neighborhood conditions.</strong> They compare each cell of <code>focal neighborhood</code> with <code>nbs</code>. The function <code>cond.4.nofn</code> can consider a <code>directional neighborhood</code> instead of a <code>focal neighborhood</code>.</p></li>
</ul>
<p><strong>Functions:</strong> <code>"?conditions"</code>, <code>"?cond.4.all"</code>, <code>"?cond.4.nofn"</code>, <code>"?cond.reclass"</code>, <code>"?classify.all"</code>, <code>"?reclass.nbs"</code>.</p>
</div>
</div>
<div id="geomorphic-management-units" class="section level2">
<h2 class="hasAnchor">
<a href="#geomorphic-management-units" class="anchor"></a>Geomorphic Management Units</h2>
<p>The following is an example using <code>scapesClassification</code> to classify marine seafloor structures, hereinafter referred to as geomorphic management units (GMUs). Our study area is located in the ‘Triangle’ of the Azores (NE Atlantic), around the islands of Faial, Pico and São Jorge. In order to identify relevant GMUs, we will use a <code>RasterStack</code> of four layers, including bathymetry and bathymetric derivatives (e.g. see <a href="https://www.mdpi.com/2076-3263/8/3/94/htm">Walbridge et al., 2018</a> as a reference for benthic derivatives):</p>
<ul>
<li>
<strong>Bathymetry:</strong> depth values;</li>
<li>
<strong>Local benthic position index:</strong> useful to identify the limits of different GMUs;</li>
<li>
<strong>Regional benthic position index:</strong> useful to identify GMUs relevant at regional scales;</li>
<li>
<strong>Slope:</strong> useful to identify areas with distinct ecological settings.</li>
</ul>
<p><em>(CRS: +proj=utm +zone=26 +datum=WGS84 +units=m +no_defs)</em></p>
<p>We will use the package <code>rasterVis</code> for plotting our results.</p>
<p>We can load the <code>RasterStack</code> and create the attribute table and the 8-neighbors list with the following code:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># LOAD LIBRARIES</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster">raster</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/edzer/sp/">sp</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://rgdal.r-forge.r-project.org">rgdal</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">scapesClassification</span><span class="op">)</span>

<span class="co"># FOR PLOTTING</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://oscarperpinan.github.io/rastervis/">rasterVis</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://latticeextra.r-forge.r-project.org/">latticeExtra</a></span><span class="op">)</span>

<span class="co"># READ RASTER STACK</span>
<span class="va">grd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"scapesClassification"</span><span class="op">)</span>, full.names <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="va">grd</span> <span class="op">&lt;-</span> <span class="va">grd</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"\\.grd"</span>, <span class="va">grd</span><span class="op">)</span><span class="op">]</span>
<span class="va">rstack</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html">stack</a></span><span class="op">(</span><span class="va">grd</span><span class="op">)</span>

<span class="co"># ATTRIBUTE TABLE</span>
<span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/attTbl.html">attTbl</a></span><span class="op">(</span><span class="va">rstack</span>, var_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bathymetry"</span>, <span class="st">"local_bpi"</span>, <span class="st">"regional_bpi"</span>, <span class="st">"slope"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># 8-neighbors list</span>
<span class="va">nbs</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ngbList.html">ngbList</a></span><span class="op">(</span><span class="va">rstack</span><span class="op">)</span>

<span class="co"># PLOT</span>
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span><span class="op">(</span><span class="va">rstack</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">terrain.colors</a></span><span class="op">(</span><span class="fl">255</span><span class="op">)</span>, margin <span class="op">=</span> <span class="cn">F</span>, main <span class="op">=</span> <span class="st">"Bathymetry"</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span><span class="op">(</span><span class="va">rstack</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">terrain.colors</a></span><span class="op">(</span><span class="fl">255</span><span class="op">)</span>, margin <span class="op">=</span> <span class="cn">F</span>, main <span class="op">=</span> <span class="st">"Local BPI"</span><span class="op">)</span>
<span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span><span class="op">(</span><span class="va">rstack</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">terrain.colors</a></span><span class="op">(</span><span class="fl">255</span><span class="op">)</span>, margin <span class="op">=</span> <span class="cn">F</span>, main <span class="op">=</span> <span class="st">"Regional BPI"</span><span class="op">)</span>
<span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span><span class="op">(</span><span class="va">rstack</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>, col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">terrain.colors</a></span><span class="op">(</span><span class="fl">255</span><span class="op">)</span>, margin <span class="op">=</span> <span class="cn">F</span>, main <span class="op">=</span> <span class="st">"Slopes"</span><span class="op">)</span>

<span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span>, <span class="va">p4</span>, nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-step0-1.png" width="100%"></p>
<div id="island-shelf-units" class="section level3">
<h3 class="hasAnchor">
<a href="#island-shelf-units" class="anchor"></a>Island Shelf Units</h3>
<p>In order to start our GMUs classification, we can consider <strong>island shelf units (ISUs)</strong>. ISUs comprise two main elements: (i) island shelves (i.e. relatively flat areas surrounding islands) and (ii) slopes that connect island shelves with the seafloor. We will classify island shelves with the numeric value <code>1000</code> and island slopes with the numeric value <code>1100</code>.</p>
<p>By definition, it is possible to consider all cells adjacent to landmasses as island shelves. We can use (i) a shapefile to determine where the islands are located, (ii) the function <em>anchor.svo</em> to extract anchor cells from spatial vector objects and (iii) the function <em>anchor.cell</em> to perform the first step of our classification by classifying all cells adjacent to landmasses as island shelves (see <code><a href="reference/anchor.cell.html">?anchor.cell</a></code> and <code><a href="reference/anchor.svo.html">?anchor.svo</a></code> for more details):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># READ SHAPEFILE</span>
<span class="va">shp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Azores.shp"</span>, package <span class="op">=</span> <span class="st">"scapesClassification"</span><span class="op">)</span>

<span class="va">island</span> <span class="op">&lt;-</span> <span class="fu">rgdal</span><span class="fu">::</span><span class="fu"><a href="http://rgdal.r-forge.r-project.org/reference/readOGR.html">readOGR</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="va">shp</span>, verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
<span class="va">island</span> <span class="op">&lt;-</span> <span class="fu">sp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/spTransform.html">spTransform</a></span><span class="op">(</span><span class="va">island</span>, <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/projection.html">crs</a></span><span class="op">(</span><span class="va">rstack</span><span class="op">)</span><span class="op">)</span>

<span class="co">## ANCHOR POINTS FROM LAND POSITION</span>
<span class="va">anchorL</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/anchor.svo.html">anchor.svo</a></span> <span class="op">(</span>rstack <span class="op">=</span> <span class="va">rstack</span>, 
                       spatial_vector_name <span class="op">=</span> <span class="va">shp</span>, 
                       only_NAs <span class="op">=</span> <span class="cn">TRUE</span>, 
                       fill_NAs <span class="op">=</span> <span class="cn">TRUE</span>, 
                       plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co">## SET CELLS ADJACENT TO LAND ANCHOR POINTS AS ISLAND SHELVES (class = 1000)</span>
<span class="va">classVector</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/anchor.cell.html">anchor.cell</a></span><span class="op">(</span><span class="va">dt</span>, 
                           <span class="va">rstack</span>, 
                           anchor      <span class="op">=</span> <span class="va">anchorL</span>, 
                           class       <span class="op">=</span> <span class="fl">1000</span>,
                           classVector <span class="op">=</span> <span class="cn">NULL</span>,
                           class2cell  <span class="op">=</span> <span class="cn">FALSE</span>,
                           class2nbs   <span class="op">=</span> <span class="cn">TRUE</span>,
                           plot        <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co">## INCLUDE ANCHOR POINTS and classVector IN A RASTER FOR PLOTTING</span>
<span class="va">rL</span>   <span class="op">&lt;-</span> <span class="va">rstack</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">rL</span><span class="op">[</span><span class="op">]</span>  <span class="op">&lt;-</span> <span class="cn">NA</span>; <span class="va">rL</span><span class="op">[</span><span class="va">anchorL</span><span class="op">]</span>  <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">rAC</span>  <span class="op">&lt;-</span> <span class="va">rstack</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">rAC</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>; <span class="va">rAC</span><span class="op">[</span><span class="va">dt</span><span class="op">$</span><span class="va">Cell</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">classVector</span>

<span class="co">## PLOT RESULTS</span>
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span><span class="op">(</span><span class="va">rstack</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">terrain.colors</a></span><span class="op">(</span><span class="fl">255</span><span class="op">)</span>, margin <span class="op">=</span> <span class="cn">F</span>, main <span class="op">=</span> <span class="st">"Bathymetry"</span>, colorkey <span class="op">=</span> <span class="cn">FALSE</span>, scales<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>draw<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span><span class="op">(</span><span class="va">rstack</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">terrain.colors</a></span><span class="op">(</span><span class="fl">255</span><span class="op">)</span>, margin <span class="op">=</span> <span class="cn">F</span>, main <span class="op">=</span> <span class="st">"Shapefile"</span>, colorkey <span class="op">=</span> <span class="cn">FALSE</span>, scales<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>draw<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">latticeExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/latticeExtra/man/layer.html">layer</a></span><span class="op">(</span><span class="op">{</span>
    
    <span class="va">island</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Azores.shp"</span>, package <span class="op">=</span> <span class="st">"scapesClassification"</span><span class="op">)</span>
    <span class="va">island</span> <span class="op">&lt;-</span> <span class="fu">rgdal</span><span class="fu">::</span><span class="fu"><a href="http://rgdal.r-forge.r-project.org/reference/readOGR.html">readOGR</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="va">island</span>, verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
    <span class="va">island</span> <span class="op">&lt;-</span> <span class="fu">sp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/spTransform.html">spTransform</a></span><span class="op">(</span><span class="va">island</span>, <span class="st">"+proj=utm +zone=26 +datum=WGS84 +units=m +no_defs"</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/pkg/sp/man/panel.html">sp.polygons</a></span><span class="op">(</span><span class="va">island</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
    
    <span class="op">}</span><span class="op">)</span>

<span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span><span class="op">(</span><span class="va">rstack</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">terrain.colors</a></span><span class="op">(</span><span class="fl">255</span><span class="op">)</span>, margin <span class="op">=</span> <span class="cn">F</span>, main <span class="op">=</span> <span class="st">"anchor.svo"</span>, colorkey <span class="op">=</span> <span class="cn">FALSE</span>, scales<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>draw<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span><span class="op">(</span><span class="va">rL</span>, col.regions <span class="op">=</span> <span class="st">"black"</span>, colorkey <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span><span class="op">(</span><span class="va">rstack</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">terrain.colors</a></span><span class="op">(</span><span class="fl">255</span><span class="op">)</span>, margin <span class="op">=</span> <span class="cn">F</span>, main <span class="op">=</span> <span class="st">"anchor.cell"</span>, colorkey <span class="op">=</span> <span class="cn">FALSE</span>, scales<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>draw<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span><span class="op">(</span><span class="va">rAC</span>, col.regions <span class="op">=</span> <span class="st">"black"</span>, colorkey <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span>, <span class="va">p4</span>, nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-step1-1.png" width="100%"></p>
<ul>
<li>
<strong><code><a href="reference/anchor.svo.html">?anchor.svo</a></code></strong> arguments:
<ul>
<li>
<code>only_NAs</code> determines the function to return only cell numbers overlapping with the spatial vector data that have missing values in rstack.</li>
<li>
<code>fill_NAs</code> determines the function to return cell numbers of cells adjacent to those overlapping with the spatial vector data that have missing values in rstack.</li>
</ul>
</li>
<li>
<strong><code><a href="reference/anchor.cell.html">?anchor.cell</a></code></strong> arguments:
<ul>
<li>
<code>class2nbs</code> attribute the new classification, defined by the argument <code>class</code>, to the cells adjacent to anchor cells.</li>
</ul>
</li>
</ul>
<p>The classification of the first step is returned as a class vector (<code>classVector</code>). All class vectors can be indexed back into the original raster considering the the cell numbers stored in the attribute table, column <code>Cell</code>. In this example we can use the following code:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## CREATE AN EMPTY RASTER WITH THE SAME PROPERTIES AS THE ORIGINAL RASTER STACK</span>
<span class="co"># r2   &lt;- rstack[[1]]</span>
<span class="co"># r2[] &lt;- NA</span>

<span class="co">## INDEX THE CLASS VECTOR INTO THE RASTER</span>
<span class="co"># r2[dt$Cell] &lt;- classVector</span>

<span class="co">## PLOT OR SAVE RESULTS</span>
<span class="co"># raster::plot(r2)</span>
<span class="co"># raster::writeRaster(r2, "step01_ISU.tif")</span>

<span class="co"># IN ALTERNATIVE USE ?cv.2.rast FUNCTION</span>
<span class="co"># cv.2.rast(rstack, dt$Cell, classVector, writeRaster = "step01_ISU.tif")</span></code></pre></div>
<p>We can now continue with the classification of ISUs:</p>
<ul>
<li><p><strong>Step 2.</strong> We define that all cells adjacent to island shelf cells having a moderate slope will be considered, as well, as island shelf. Note that we want to push this classification to all cells neighboring newly classified cells (neighbors of neighbors or <em>nofn</em>) that respect our conditions. We can do so using the function <em>cond.4.nofn</em> to classify all neighbors and <em>nofn</em> of island shelf cells (<code>nbs_of = 1000</code>) as island shelf (<code>class = 1000</code>) if they have a moderate slope (<code>slope &lt;= 5</code>) (see <code><a href="reference/cond.4.nofn.html">?cond.4.nofn</a></code> and <code><a href="reference/conditions.html">?conditions</a></code> for more details).</p></li>
<li><p><strong>Step 3.</strong> Additionally, we can consider that if a cell is surrounded by at least 5 cells classified as island shelf, then it can also be classified as island shelf. Again we use the function <em>cond.4.nofn</em>, but this time we set the argument <code>min.border = 0.6</code> (i.e., at least 60% of the 8 cells neighboring the cell in evaluation have to be classified as island shelf).</p></li>
<li><p><strong>Step 4.</strong> We can now classify island slopes (<code>class = 1100</code>). Island slopes are adjacent to island shelves and to island slopes (<code>nbs_of = c(1000, 1100</code>). We consider that all island slopes are elevated with respect to the seafloor (<code>regional_bpi{}&gt;100</code>). Note that we are using an <em>absolute focal neighborhood condition</em> based on <em>directional neighborhoods</em> (curly bracket flag and argument <code>directional = TRUE</code>) (see <code><a href="reference/conditions.html">?conditions</a></code> for more details).</p></li>
<li><p><strong>Step 5.</strong> We can then consider that as long as newly evaluated cells adjacent to slopes are deeper than their <em>directional neighborhood</em> they also belong to the class island slopes (<code>bathymetry &lt; bathymetry{} - 10 &amp; local_bpi&gt;0</code>). The term <code>bathymetry{} - 10</code> consider that if the cells in evaluation are 10m shallower than the <em>directional neighborhood</em> they can still be classified as island slopes; the term <code>local_bpi&gt;0</code> define the limits between distinct ISUs (i.e. when <code>local_bpi &lt; 0</code> we have reached the limit of our ISU).</p></li>
</ul>
<!-- end list --><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># STEP 2, ISU (class = 1000)</span>
<span class="va">classVector2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cond.4.nofn.html">cond.4.nofn</a></span><span class="op">(</span><span class="va">dt</span>, <span class="va">nbs</span>, nbsIndex <span class="op">=</span> <span class="cn">FALSE</span>,
                            <span class="va">classVector</span>, 
                            nbs_of <span class="op">=</span> <span class="fl">1000</span>, 
                            conditions <span class="op">=</span> <span class="st">"slope &lt;= 5"</span>, 
                            class <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>

<span class="co"># STEP 3, ISU (class = 1000)</span>
<span class="va">classVector3</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cond.4.nofn.html">cond.4.nofn</a></span><span class="op">(</span><span class="va">dt</span>, <span class="va">nbs</span>, nbsIndex <span class="op">=</span> <span class="cn">FALSE</span>,
                            <span class="va">classVector2</span>, 
                            nbs_of <span class="op">=</span> <span class="fl">1000</span>, 
                            conditions <span class="op">=</span> <span class="st">"TRUE"</span>, 
                            class <span class="op">=</span> <span class="fl">1000</span>,
                            min.border <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span>

<span class="co"># STEP 4, ISU (class = 1100)</span>
<span class="va">classVector4</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cond.4.nofn.html">cond.4.nofn</a></span><span class="op">(</span><span class="va">dt</span>, <span class="va">nbs</span>, nbsIndex <span class="op">=</span> <span class="cn">FALSE</span>,
                            <span class="va">classVector3</span>, 
                            nbs_of <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">1100</span><span class="op">)</span>, 
                            conditions <span class="op">=</span> <span class="st">"regional_bpi{} &gt; 100"</span>, 
                            class <span class="op">=</span> <span class="fl">1100</span>,
                            fn_perc <span class="op">=</span> <span class="fl">0.5</span>, 
                            directional <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># STEP 5, ISU (class = 1100)</span>
<span class="va">classVector5</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cond.4.nofn.html">cond.4.nofn</a></span><span class="op">(</span><span class="va">dt</span>, <span class="va">nbs</span>, nbsIndex <span class="op">=</span> <span class="cn">FALSE</span>,
                            <span class="va">classVector4</span>, 
                            nbs_of <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">1100</span><span class="op">)</span>, 
                            conditions <span class="op">=</span> <span class="st">"bathymetry &lt; bathymetry{} - 10 &amp; local_bpi &gt; 0"</span>, 
                            class <span class="op">=</span> <span class="fl">1100</span>,
                            min.border <span class="op">=</span> <span class="fl">0.2</span>, 
                            fn_perc <span class="op">=</span> <span class="fl">0.6</span>, 
                            directional <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co">## INCLUDE classVector IN A RASTER FOR PLOTTING</span>
<span class="va">r2</span> <span class="op">&lt;-</span> <span class="va">rstack</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">r2</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>; <span class="va">r2</span><span class="op">[</span><span class="va">dt</span><span class="op">$</span><span class="va">Cell</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">classVector2</span>
<span class="va">r3</span> <span class="op">&lt;-</span> <span class="va">rstack</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">r3</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>; <span class="va">r3</span><span class="op">[</span><span class="va">dt</span><span class="op">$</span><span class="va">Cell</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">classVector3</span>
<span class="va">r4</span> <span class="op">&lt;-</span> <span class="va">rstack</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">r4</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>; <span class="va">r4</span><span class="op">[</span><span class="va">dt</span><span class="op">$</span><span class="va">Cell</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">classVector4</span>
<span class="va">r5</span> <span class="op">&lt;-</span> <span class="va">rstack</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">r5</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>; <span class="va">r5</span><span class="op">[</span><span class="va">dt</span><span class="op">$</span><span class="va">Cell</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">classVector5</span>

<span class="co">## PLOT RESULTS</span>
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span><span class="op">(</span><span class="va">rstack</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">terrain.colors</a></span><span class="op">(</span><span class="fl">255</span><span class="op">)</span>, margin <span class="op">=</span> <span class="cn">F</span>, main <span class="op">=</span> <span class="st">"STEP 2, ISU CLASS = 1000"</span>, colorkey <span class="op">=</span> <span class="cn">FALSE</span>, scales<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>draw<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span><span class="op">(</span><span class="va">r2</span>, col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span><span class="op">)</span>, colorkey <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span><span class="op">(</span><span class="va">rstack</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">terrain.colors</a></span><span class="op">(</span><span class="fl">255</span><span class="op">)</span>, margin <span class="op">=</span> <span class="cn">F</span>, main <span class="op">=</span> <span class="st">"STEP 3, ISU CLASS = 1000"</span>, colorkey <span class="op">=</span> <span class="cn">FALSE</span>, scales<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>draw<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span><span class="op">(</span><span class="va">r3</span>, col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span><span class="op">)</span>, colorkey <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span><span class="op">(</span><span class="va">rstack</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">terrain.colors</a></span><span class="op">(</span><span class="fl">255</span><span class="op">)</span>, margin <span class="op">=</span> <span class="cn">F</span>, main <span class="op">=</span> <span class="st">"STEP 4, ISU CLASS = 1100"</span>, colorkey <span class="op">=</span> <span class="cn">FALSE</span>, scales<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>draw<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span><span class="op">(</span><span class="va">r4</span>, col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"grey60"</span><span class="op">)</span>, colorkey <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span><span class="op">(</span><span class="va">rstack</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">terrain.colors</a></span><span class="op">(</span><span class="fl">255</span><span class="op">)</span>, margin <span class="op">=</span> <span class="cn">F</span>, main <span class="op">=</span> <span class="st">"STEP 5, ISU CLASS = 1100"</span>, colorkey <span class="op">=</span> <span class="cn">FALSE</span>, scales<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>draw<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span><span class="op">(</span><span class="va">r5</span>, col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"grey60"</span><span class="op">)</span>, colorkey <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span>, <span class="va">p4</span>, nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-step2345-1.png" width="100%"></p>
<p><strong>Note</strong> that at each step our <code>classVector</code> is updated with newly classified cells.</p>
</div>
<div id="high-relief-units" class="section level3">
<h3 class="hasAnchor">
<a href="#high-relief-units" class="anchor"></a>High Relief Units</h3>
<p><strong>Identify local peaks</strong></p>
<p>We can now proceed with the classification of <strong>high relief units (HRUs)</strong>. HRUs comprise two main elements: (i) local peaks (<code>class = 2000</code>) and (ii) slopes (<code>class = 2100</code>).</p>
<p>To start we will identify local peaks and use them as anchor cells to proceed with our classification. We will use the function <em>anchor.seed</em> to identify local maxima in elevation (i.e. peaks) (see <code><a href="reference/anchor.seed.html">?anchor.seed</a></code> for more details).</p>
<ol>
<li><p>First we will define a filter to determine were to look for peaks. We consider HRUs as having areas that elevates at least 500m from the seafloor (<code>regional_bpi &gt; 500</code>) not classified as ISUs. We will use the function <em>cond.4.all</em>, that does not consider class contiguity, to define our filter (see <code><a href="reference/cond.4.all.html">?cond.4.all</a></code> for more details).</p></li>
<li><p>We can will use the function <em>anchor.seed</em> to identify our peaks. This function takes three sets of conditions: (i) <code>cond.filter</code> is used to determine were to look for local minima or maxima; (ii) <code>cond.seed</code> is used to determine local minima or maxima; (iii) <code>cond.isol</code> is used to determine how one local maxima or minima is isolated from another. In this case our <code>cond.isol</code> considers a focal cell conditions (square brackets flag) (<code>bathymetry[] &gt; bathymetry + (-10)</code>). This condition states that as long as the cell in evaluation is deeper than the focal cell it can be considered as a not-peak cell. The term <code>bathymetry + (-10)</code> indicated that small depth rises (up to 10m) in the cell in evaluation are ignored (see <code><a href="reference/anchor.seed.html">?anchor.seed</a></code> and <code><a href="reference/conditions.html">?conditions</a></code> for more details).</p></li>
</ol>
<!-- end list --><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># DEFINE THE PEAK  FILTER</span>
<span class="va">pks_filter</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cond.4.all.html">cond.4.all</a></span><span class="op">(</span><span class="va">dt</span>, 
                         conditions <span class="op">=</span> <span class="st">"regional_bpi &gt; 500 &amp; local_bpi &gt; 50"</span>, 
                         <span class="va">classVector5</span>, 
                         class <span class="op">=</span> <span class="fl">1</span>, 
                         overwrite_class <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>

<span class="co"># IDENTIFY LOCAL PEAKS</span>
<span class="va">pks</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/anchor.seed.html">anchor.seed</a></span><span class="op">(</span><span class="va">dt</span>,
                   <span class="va">nbs</span>,
                   class <span class="op">=</span> <span class="fl">1</span>,
                   cond.filter <span class="op">=</span> <span class="st">"classVector == 1"</span>,
                   cond.seed   <span class="op">=</span> <span class="st">"bathymetry == max(bathymetry)"</span>,
                   cond.isol   <span class="op">=</span> <span class="st">"bathymetry[] &gt; bathymetry + (-10)"</span>,
                   lag.isol    <span class="op">=</span> <span class="fl">2</span>,
                   classVector <span class="op">=</span> <span class="va">pks_filter</span>,
                   isolationClass <span class="op">=</span> <span class="cn">TRUE</span>, 
                   silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co">## INCLUDE classVector IN A RASTER FOR PLOTTING</span>
<span class="va">r2</span> <span class="op">&lt;-</span> <span class="va">rstack</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">r2</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>; <span class="va">r2</span><span class="op">[</span><span class="va">dt</span><span class="op">$</span><span class="va">Cell</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pks_filter</span>
<span class="va">r3</span> <span class="op">&lt;-</span> <span class="va">rstack</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">r3</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>; <span class="va">r3</span><span class="op">[</span><span class="va">dt</span><span class="op">$</span><span class="va">Cell</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pks</span>

<span class="co">## PLOT RESULTS</span>
<span class="va">r2</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">ratify</a></span><span class="op">(</span><span class="va">r2</span><span class="op">)</span>; <span class="va">rat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">levels</a></span><span class="op">(</span><span class="va">r2</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">rat</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'pks_flt'</span>, <span class="st">'ISU_1000'</span>, <span class="st">'ISU_1100'</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">levels</a></span><span class="op">(</span><span class="va">r2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">rat</span>
<span class="va">r3</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">ratify</a></span><span class="op">(</span><span class="va">r3</span><span class="op">)</span>; <span class="va">rat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">levels</a></span><span class="op">(</span><span class="va">r3</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">rat</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'not_pks'</span>, <span class="st">'pks'</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">levels</a></span><span class="op">(</span><span class="va">r3</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">rat</span>

<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span><span class="op">(</span><span class="va">r2</span>, att <span class="op">=</span> <span class="st">"class"</span>, col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lightblue2"</span>, <span class="st">"black"</span>, <span class="st">"grey60"</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"PEAK FILTER"</span>, margin <span class="op">=</span> <span class="cn">FALSE</span>, scales<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>draw<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span><span class="op">(</span><span class="va">r3</span>, att <span class="op">=</span> <span class="st">"class"</span>, col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lightblue2"</span>, <span class="st">"navy"</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"PEAKS"</span>,  margin <span class="op">=</span> <span class="cn">FALSE</span>, scales<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>draw<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>

<span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-pks-1.png" width="100%"></p>
<p><strong>Classify HRUs</strong></p>
<p>We can now continue with the classification of HRUs considering peaks (<code>class = 2000</code>) and high relief slopes (<code>class = 2100</code>) with the following steps:</p>
<ul>
<li><p><strong>Step 6.</strong> Include peaks in our classification vector with the function <em>anchor.cell</em> (see <code>anchor.cell</code> for more details).</p></li>
<li><p><strong>Step 7.</strong> High relieves slopes are elevated with respect to the seafloor (<code>regional_bpi{} &gt; 100</code>).</p></li>
<li><p><strong>Step 8.</strong> As long as newly evaluated cells adjacent to slopes are deeper than their <em>directional neighborhood</em> they also belong to the class high relieves slopes (<code>bathymetry &lt; bathymetry{} - 10 &amp; local_bpi&gt;0</code>); the term <code>local_bpi&gt;0</code> define the limits between distinct HRUs.</p></li>
<li><p><strong>Step 9.</strong> If a cell is surrounded by at least 5 cells classified as high relief slope, then it can also be classified as high relief slope (<code>min.border = 0.6</code>).</p></li>
</ul>
<!-- end list --><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## REMOVE NOT PEAKS FROM pks CLASS VECTOR AND EXTRACT PEAK CELLS </span>
<span class="va">pks</span><span class="op">[</span><span class="va">pks</span> <span class="op">==</span> <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">anchorP</span> <span class="op">&lt;-</span> <span class="va">dt</span><span class="op">$</span><span class="va">Cell</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">pks</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>

<span class="co"># STEP 6, HRU (class = 2000)</span>
<span class="va">classVector6</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/anchor.cell.html">anchor.cell</a></span><span class="op">(</span><span class="va">dt</span>, 
                            <span class="va">rstack</span>, 
                            anchor <span class="op">=</span> <span class="va">anchorP</span>, 
                            class <span class="op">=</span> <span class="fl">2000</span>, 
                            classVector <span class="op">=</span> <span class="va">classVector5</span>, 
                            class2cell <span class="op">=</span> <span class="cn">TRUE</span>, 
                            class2nbs <span class="op">=</span> <span class="cn">FALSE</span>,
                            plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># STEP 7, HRU (class = 2100)</span>
<span class="va">classVector7</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cond.4.nofn.html">cond.4.nofn</a></span><span class="op">(</span><span class="va">dt</span>, <span class="va">nbs</span>, nbsIndex <span class="op">=</span> <span class="cn">FALSE</span>,
                            <span class="va">classVector6</span>, 
                            nbs_of <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2000</span>, <span class="fl">2100</span><span class="op">)</span>, 
                            conditions <span class="op">=</span> <span class="st">"regional_bpi{} &gt; 100"</span>, 
                            class <span class="op">=</span> <span class="fl">2100</span>,
                            fn_perc <span class="op">=</span> <span class="fl">0.5</span>, 
                            directional <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># STEP 8, HRU (class = 2100)</span>
<span class="va">classVector8</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cond.4.nofn.html">cond.4.nofn</a></span><span class="op">(</span><span class="va">dt</span>, <span class="va">nbs</span>, nbsIndex <span class="op">=</span> <span class="cn">FALSE</span>,
                            <span class="va">classVector7</span>, 
                            nbs_of <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2000</span>, <span class="fl">2100</span><span class="op">)</span>, 
                            conditions <span class="op">=</span> <span class="st">"bathymetry &lt; bathymetry{} - 10 &amp; local_bpi &gt; 0"</span>, 
                            class <span class="op">=</span> <span class="fl">2100</span>,
                            min.border <span class="op">=</span> <span class="fl">0.2</span>, 
                            fn_perc <span class="op">=</span> <span class="fl">0.6</span>, 
                            directional <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># STEP 9, HRU (class = 2100)</span>
<span class="va">classVector9</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cond.4.nofn.html">cond.4.nofn</a></span><span class="op">(</span><span class="va">dt</span>, <span class="va">nbs</span>, nbsIndex <span class="op">=</span> <span class="cn">FALSE</span>,
                            <span class="va">classVector8</span>, 
                            nbs_of <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2000</span>, <span class="fl">2100</span><span class="op">)</span>, 
                            conditions <span class="op">=</span> <span class="st">"TRUE"</span>, 
                            class <span class="op">=</span> <span class="fl">2100</span>,
                            min.border <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> 

<span class="co">## INCLUDE classVector IN A RASTER FOR PLOTTING</span>
<span class="va">r2</span> <span class="op">&lt;-</span> <span class="va">rstack</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">r2</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>; <span class="va">r2</span><span class="op">[</span><span class="va">dt</span><span class="op">$</span><span class="va">Cell</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">classVector6</span>
<span class="va">r3</span> <span class="op">&lt;-</span> <span class="va">rstack</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">r3</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>; <span class="va">r3</span><span class="op">[</span><span class="va">dt</span><span class="op">$</span><span class="va">Cell</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">classVector7</span>
<span class="va">r4</span> <span class="op">&lt;-</span> <span class="va">rstack</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">r4</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>; <span class="va">r4</span><span class="op">[</span><span class="va">dt</span><span class="op">$</span><span class="va">Cell</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">classVector8</span>
<span class="va">r5</span> <span class="op">&lt;-</span> <span class="va">rstack</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">r5</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>; <span class="va">r5</span><span class="op">[</span><span class="va">dt</span><span class="op">$</span><span class="va">Cell</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">classVector9</span>

<span class="co">## PLOT RESULTS</span>
<span class="va">r2</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">ratify</a></span><span class="op">(</span><span class="va">r2</span><span class="op">)</span>; <span class="va">rat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">levels</a></span><span class="op">(</span><span class="va">r2</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">rat</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'1000'</span>, <span class="st">'1100'</span>, <span class="st">'2000'</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">levels</a></span><span class="op">(</span><span class="va">r2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">rat</span>
<span class="va">r3</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">ratify</a></span><span class="op">(</span><span class="va">r3</span><span class="op">)</span>; <span class="va">rat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">levels</a></span><span class="op">(</span><span class="va">r3</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">rat</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'1000'</span>, <span class="st">'1100'</span>, <span class="st">'2000'</span>, <span class="st">'2100'</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">levels</a></span><span class="op">(</span><span class="va">r3</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">rat</span>
<span class="va">r4</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">ratify</a></span><span class="op">(</span><span class="va">r4</span><span class="op">)</span>; <span class="va">rat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">levels</a></span><span class="op">(</span><span class="va">r4</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">rat</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'1000'</span>, <span class="st">'1100'</span>, <span class="st">'2000'</span>, <span class="st">'2100'</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">levels</a></span><span class="op">(</span><span class="va">r4</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">rat</span>
<span class="va">r5</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">ratify</a></span><span class="op">(</span><span class="va">r5</span><span class="op">)</span>; <span class="va">rat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">levels</a></span><span class="op">(</span><span class="va">r5</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">rat</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'1000'</span>, <span class="st">'1100'</span>, <span class="st">'2000'</span>, <span class="st">'2100'</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">levels</a></span><span class="op">(</span><span class="va">r5</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">rat</span>

<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span><span class="op">(</span><span class="va">rstack</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">terrain.colors</a></span><span class="op">(</span><span class="fl">255</span><span class="op">)</span>, margin <span class="op">=</span> <span class="cn">F</span>, main <span class="op">=</span> <span class="st">"STEP 6, HRU (class = 2000)"</span>, colorkey <span class="op">=</span> <span class="cn">FALSE</span>, scales<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>draw<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span><span class="op">(</span><span class="va">r2</span>, att <span class="op">=</span> <span class="st">"class"</span>, col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"grey60"</span>, <span class="st">"navy"</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"STEP6"</span>, margin <span class="op">=</span> <span class="cn">FALSE</span>, colorkey<span class="op">=</span> <span class="cn">FALSE</span>, scales<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>draw<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span><span class="op">(</span><span class="va">rstack</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">terrain.colors</a></span><span class="op">(</span><span class="fl">255</span><span class="op">)</span>, margin <span class="op">=</span> <span class="cn">F</span>, main <span class="op">=</span> <span class="st">"STEP 7, HRU (class = 2100)"</span>, colorkey <span class="op">=</span> <span class="cn">FALSE</span>, scales<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>draw<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span><span class="op">(</span><span class="va">r3</span>, att <span class="op">=</span> <span class="st">"class"</span>, col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"grey60"</span>, <span class="st">"navy"</span>, <span class="st">"lightblue2"</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"STEP6"</span>, margin <span class="op">=</span> <span class="cn">FALSE</span>, colorkey<span class="op">=</span> <span class="cn">FALSE</span>, scales<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>draw<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span><span class="op">(</span><span class="va">rstack</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">terrain.colors</a></span><span class="op">(</span><span class="fl">255</span><span class="op">)</span>, margin <span class="op">=</span> <span class="cn">F</span>, main <span class="op">=</span> <span class="st">"STEP 8, HRU (class = 2100)"</span>, colorkey <span class="op">=</span> <span class="cn">FALSE</span>, scales<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>draw<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span><span class="op">(</span><span class="va">r4</span>, att <span class="op">=</span> <span class="st">"class"</span>, col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"grey60"</span>, <span class="st">"navy"</span>, <span class="st">"lightblue2"</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"STEP6"</span>, margin <span class="op">=</span> <span class="cn">FALSE</span>, colorkey<span class="op">=</span> <span class="cn">FALSE</span>, scales<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>draw<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span><span class="op">(</span><span class="va">rstack</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">terrain.colors</a></span><span class="op">(</span><span class="fl">255</span><span class="op">)</span>, margin <span class="op">=</span> <span class="cn">F</span>, main <span class="op">=</span> <span class="st">"STEP 9, HRU (class = 2100)"</span>, colorkey <span class="op">=</span> <span class="cn">FALSE</span>, scales<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>draw<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span><span class="op">(</span><span class="va">r5</span>, att <span class="op">=</span> <span class="st">"class"</span>, col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"grey60"</span>, <span class="st">"navy"</span>, <span class="st">"lightblue2"</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"STEP6"</span>, margin <span class="op">=</span> <span class="cn">FALSE</span>, colorkey<span class="op">=</span> <span class="cn">FALSE</span>, scales<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>draw<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>

<span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span>, <span class="va">p4</span>, nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-steps6789-1.png" width="100%"></p>
</div>
<div id="reclassify-cells" class="section level3">
<h3 class="hasAnchor">
<a href="#reclassify-cells" class="anchor"></a>Reclassify Cells</h3>
<p>In the final steps of our classification we will reclassify some cell. Some marine organisms live in environments characterized by steep slopes (e.g., <code>slope &gt;= 10</code>). We will highlight such slopes on ISUs and HRUs using the function <em>cond.reclass</em>. This function will reclassify ISU slopes as moderate (<code>class = 1100</code>) and steep (<code>class = 1200</code>) and HRU slopes as moderate (<code>class = 2100</code>) and steep (<code>class = 2200</code>). See <code><a href="reference/cond.reclass.html">?cond.reclass</a></code> for more details.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># STEP 10, RECLASSIFY STEEP SLOPES ON ISUs (class = 1200)</span>
<span class="va">classVector10</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cond.reclass.html">cond.reclass</a></span><span class="op">(</span><span class="va">dt</span>, <span class="va">nbs</span>, nbsIndex <span class="op">=</span> <span class="cn">FALSE</span>,
                              <span class="va">classVector9</span>,
                              conditions <span class="op">=</span> <span class="st">"slope &gt;= 10"</span>,
                              class <span class="op">=</span> <span class="fl">1100</span>,
                              reclass <span class="op">=</span> <span class="fl">1200</span><span class="op">)</span>

<span class="co"># STEP 10, RECLASSIFY STEEP SLOPES ON HRUs (class = 2200)</span>
<span class="va">classVector11</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cond.reclass.html">cond.reclass</a></span><span class="op">(</span><span class="va">dt</span>, <span class="va">nbs</span>, nbsIndex <span class="op">=</span> <span class="cn">FALSE</span>,
                              <span class="va">classVector10</span>,
                              conditions <span class="op">=</span> <span class="st">"slope &gt;= 10"</span>,
                              class <span class="op">=</span> <span class="fl">2100</span>,
                              reclass <span class="op">=</span> <span class="fl">2200</span><span class="op">)</span>

<span class="co">## INCLUDE classVector IN A RASTER FOR PLOTTING</span>
<span class="va">r3</span> <span class="op">&lt;-</span> <span class="va">rstack</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">r3</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>; <span class="va">r3</span><span class="op">[</span><span class="va">dt</span><span class="op">$</span><span class="va">Cell</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">classVector11</span>

<span class="co">## PLOT RESULTS</span>
<span class="va">r3</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">ratify</a></span><span class="op">(</span><span class="va">r3</span><span class="op">)</span>; <span class="va">rat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">levels</a></span><span class="op">(</span><span class="va">r3</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>; <span class="va">rat</span><span class="op">$</span><span class="va">class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'1000'</span>, <span class="st">'1100'</span>, <span class="st">'1200'</span>, <span class="st">'2000'</span>, <span class="st">'2100'</span>, <span class="st">'2200'</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">levels</a></span><span class="op">(</span><span class="va">r3</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">rat</span>

<span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span><span class="op">(</span><span class="va">rstack</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">terrain.colors</a></span><span class="op">(</span><span class="fl">255</span><span class="op">)</span>, margin <span class="op">=</span> <span class="cn">F</span>, main <span class="op">=</span> <span class="st">"FINAL CLASSIFICATION"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/levelplot-methods.html">levelplot</a></span><span class="op">(</span><span class="va">r3</span>, att <span class="op">=</span> <span class="st">"class"</span>, col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"grey60"</span>, <span class="st">"white"</span>, <span class="st">"navy"</span>, <span class="st">"lightblue2"</span>, <span class="st">"lightcyan"</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"STEP10"</span>, margin <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-reclassify-1.png" width="100%"><strong><em>Final classification colorkey:</em></strong> island shelf (ISU_1000) (<strong>black</strong>); island moderate slopes (ISU_1100) (<strong>grey</strong>); island steep slopes (ISU_1200) (<strong>white</strong>); high relief peaks (HRU_2000) (<strong>dark blue</strong>); high relief moderate slopes (<strong>light blue</strong>); high relief steep slopes (<strong>light cyan</strong>).</p>
</div>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Gerald H. Taranto <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-7968-1982" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Gerald H. Taranto.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
